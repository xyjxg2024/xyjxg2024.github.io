<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½åœŸå£¤åˆ†æç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --primary-color: #2a6b3c;
            --secondary-color: #8bc34a;
            --background: linear-gradient(135deg, #f3f9f1 0%, #e6f4ea 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background: var(--background);
            min-height: 100vh;
            padding: 2rem;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
            padding: 2rem;
        }

        /* å¥åº·è¯„åˆ†æ¨¡å— */
        .health-score {
            position: relative;
            /* æ·»åŠ æ­¤è¡Œä»¥æ”¯æŒç»å¯¹å®šä½ */
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        /* è¿”å›æŒ‰é’®æ ·å¼ */
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        /* å®æ—¶æ•°æ®æ¨¡å— */
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .sensor-card {
            background: rgba(248, 255, 249, 0.9);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }

        .sensor-card:hover {
            transform: translateY(-5px);
        }

        .param-label {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .param-value {
            color: var(--primary-color);
            font-size: 2rem;
            font-weight: 500;
        }

        /* å¯è§†åŒ–åˆ†ææ¨¡å— */
        .visualization-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            height: 600px;
            margin-bottom: 3rem;
        }

        .chart-panel {
            background: rgba(248, 255, 249, 0.9);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        #nutrientChart,
        #soilProfile3d {
            width: 100%;
            height: 100%;
        }

        /* æ—¶é—´é€‰æ‹©å™¨ */
        .time-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .time-btn {
            padding: 0.5rem 1.5rem;
            border: 2px solid #e0f0e5;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-btn.active {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
            color: white;
        }

        /* å»ºè®®æ¨¡å— */
        .advice-panel {
            background: rgba(248, 255, 249, 0.9);
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
        }

        .recommendation {
            padding: 1rem;
            background: white;
            border-radius: 10px;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* æ‰‹åŠ¨è¾“å…¥æŒ‰é’®æ ·å¼ */
        .manual-input-btn {
            background: linear-gradient(45deg, var(--secondary-color), #7cb342);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-size: 1rem;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
        }

        .manual-input-btn:hover {
            background: #7cb342;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>

<body>
    <div class="dashboard">
        <!-- å¥åº·è¯„åˆ† -->
        <div class="health-score">
            <!-- è¿”å›æŒ‰é’® -->
            <a href="index.html" class="back-button">
                â† è¿”å›ä¸»ç•Œé¢
            </a>
            <h2>ğŸ† åœŸå£¤å¥åº·ç»¼åˆè¯„åˆ†</h2>
            <div class="score-value" id="healthScore">86</div>
            <p id="healthStatus">å½“å‰çŠ¶æ€ï¼šä¼˜è‰¯ | é€‚å®œç§æ¤æ°´ç¨»</p>
        </div>

        <!-- å®æ—¶æ•°æ® -->
        <div class="time-selector">
            <button class="time-btn active">å®æ—¶</button>
            <button class="time-btn">24å°æ—¶</button>
            <button class="time-btn">7å¤©</button>
        </div>

        <div class="sensor-grid">
            <div class="sensor-card">
                <div class="param-label">ğŸŒ± æœ‰æœºè´¨å«é‡</div>
                <div class="param-value" id="organicMatter">2.8%</div>
                <div class="param-label" style="margin-top:1rem">æ­£å¸¸èŒƒå›´: 2.5-3.5%</div>
            </div>
            <div class="sensor-card">
                <div class="param-label">âš–ï¸ pHå€¼</div>
                <div class="param-value" id="pHValue">6.5</div>
                <div class="param-label" style="margin-top:1rem">é…¸ç¢±åº¦: å¾®é…¸æ€§</div>
            </div>
            <div class="sensor-card">
                <div class="param-label">ğŸ”„ ç”µå¯¼ç‡</div>
                <div class="param-value" id="conductivity">1.2 mS/cm</div>
                <div class="param-label" style="margin-top:1rem">ç›åˆ†å«é‡: æ­£å¸¸</div>
            </div>
            <div class="sensor-card">
                <div class="param-label">ğŸ’§ å«æ°´é‡</div>
                <div class="param-value" id="waterContent">62%</div>
                <div class="param-label" style="margin-top:1rem">çŒæº‰å»ºè®®: æš‚ä¸éœ€è¦</div>
            </div>
        </div>

        <!-- å¯è§†åŒ–åˆ†æ -->
        <div class="visualization-container">
            <div class="chart-panel">
                <h3>ğŸ“Š å…»åˆ†åˆ†æé›·è¾¾å›¾</h3>
                <div class="nutrient-chart" id="nutrientChart"></div>
            </div>
            <div class="chart-panel">
                <h3>ğŸ—ºï¸ åœŸå£¤å‰–é¢ç»“æ„</h3>
                <div id="soilProfile3d"></div>
            </div>
        </div>

        <!-- æ™ºèƒ½å»ºè®® -->
        <div class="advice-panel">
            <h3>ğŸ’¡ æ”¹è‰¯å»ºè®®</h3>
            <div class="recommendation">
                <div class="param-label">ğŸŒ¾ æ–½è‚¥å»ºè®®</div>
                <p id="fertilizerAdvice">å»ºè®®å¢æ–½æœ‰æœºè‚¥ 500kg/äº©ï¼Œè¡¥å……æ°®è‚¥ 10kg/äº©</p>
            </div>
            <div class="recommendation">
                <div class="param-label">ğŸšœ è€•ä½œå»ºè®®</div>
                <p id="tillageAdvice">å»ºè®®è¿›è¡Œæ·±åº¦ç¿»è€•ï¼ˆ30-40cmï¼‰ï¼Œæ”¹å–„åœŸå£¤é€æ°”æ€§</p>
            </div>
            <div class="recommendation">
                <div class="param-label">ğŸ’¦ çŒæº‰å»ºè®®</div>
                <p id="irrigationAdvice">å½“å‰å«æ°´é‡é€‚å®œï¼Œæœªæ¥72å°æ—¶æ— éœ€çŒæº‰</p>
            </div>
        </div>

        <!-- æ‰‹åŠ¨è¾“å…¥æŒ‰é’® -->
        <button class="manual-input-btn" onclick="location.href='groundinput.html'">æ‰‹åŠ¨è¾“å…¥</button>
    </div>

    <script>
        // ç”Ÿæˆéšæœºæ•°æ®
        function generateRandomData() {
            // å¥åº·è¯„åˆ† (70-95)
            const healthScore = Math.floor(Math.random() * 26) + 70;
            document.getElementById('healthScore').textContent = healthScore;

            // æ ¹æ®å¥åº·è¯„åˆ†æ›´æ–°çŠ¶æ€æè¿°
            let healthStatus;
            if (healthScore >= 85) {
                healthStatus = 'å½“å‰çŠ¶æ€ï¼šä¼˜è‰¯ | é€‚å®œç§æ¤æ°´ç¨»';
            } else if (healthScore >= 70) {
                healthStatus = 'å½“å‰çŠ¶æ€ï¼šè‰¯å¥½ | é€‚å®œç§æ¤å¤§éƒ¨åˆ†ä½œç‰©';
            } else {
                healthStatus = 'å½“å‰çŠ¶æ€ï¼šä¸€èˆ¬ | éœ€è¦æ”¹è‰¯åç§æ¤';
            }
            document.getElementById('healthStatus').textContent = healthStatus;

            // æœ‰æœºè´¨å«é‡ (2.5-3.5%)
            const organicMatter = (Math.random() * 1.0 + 2.5).toFixed(1);
            document.getElementById('organicMatter').textContent = organicMatter + '%';

            // pHå€¼ (5.5-7.5)
            const pHValue = (Math.random() * 2.0 + 5.5).toFixed(1);
            document.getElementById('pHValue').textContent = pHValue;

            // ç”µå¯¼ç‡ (0.8-1.6 mS/cm)
            const conductivity = (Math.random() * 0.8 + 0.8).toFixed(1);
            document.getElementById('conductivity').textContent = conductivity + ' mS/cm';

            // å«æ°´é‡ (50-75%)
            const waterContent = Math.floor(Math.random() * 26) + 50;
            document.getElementById('waterContent').textContent = waterContent + '%';

            // æ›´æ–°çŒæº‰å»ºè®®
            let irrigationAdvice;
            if (waterContent >= 70) {
                irrigationAdvice = 'å½“å‰å«æ°´é‡è¿‡é«˜ï¼Œå»ºè®®æ’æ°´';
            } else if (waterContent >= 60) {
                irrigationAdvice = 'å½“å‰å«æ°´é‡é€‚å®œï¼Œæœªæ¥72å°æ—¶æ— éœ€çŒæº‰';
            } else {
                irrigationAdvice = 'å½“å‰å«æ°´é‡è¾ƒä½ï¼Œå»ºè®®é€‚é‡çŒæº‰';
            }
            document.getElementById('irrigationAdvice').textContent = irrigationAdvice;

            // æ›´æ–°æ–½è‚¥å»ºè®®
            updateFertilizerAdvice();

            // æ›´æ–°è€•ä½œå»ºè®®
            updateTillageAdvice();
        }

        // æ›´æ–°æ–½è‚¥å»ºè®®
        function updateFertilizerAdvice() {
            const organicMatter = parseFloat(document.getElementById('organicMatter').textContent);
            const pHValue = parseFloat(document.getElementById('pHValue').textContent);
            const conductivity = parseFloat(document.getElementById('conductivity').textContent.split(' ')[0]);

            let fertilizerAdvice;
            if (organicMatter < 2.5) {
                fertilizerAdvice = 'å»ºè®®å¢æ–½æœ‰æœºè‚¥ 800kg/äº©ï¼Œè¡¥å……æ°®è‚¥ 15kg/äº©ï¼Œæ”¹å–„åœŸå£¤è‚¥åŠ›';
            } else if (organicMatter < 3.0) {
                fertilizerAdvice = 'å»ºè®®å¢æ–½æœ‰æœºè‚¥ 500kg/äº©ï¼Œè¡¥å……æ°®è‚¥ 10kg/äº©';
            } else {
                fertilizerAdvice = 'åœŸå£¤æœ‰æœºè´¨å«é‡è‰¯å¥½ï¼Œç»´æŒç°æœ‰æ–½è‚¥é‡å³å¯';
            }

            if (pHValue < 6.0) {
                fertilizerAdvice += 'ï¼ŒåŒæ—¶å»ºè®®æ–½ç”¨çŸ³ç°æ”¹è‰¯é…¸æ€§åœŸå£¤';
            } else if (pHValue > 7.0) {
                fertilizerAdvice += 'ï¼ŒåŒæ—¶å»ºè®®æ–½ç”¨ç¡«ç£ºæ”¹è‰¯ç¢±æ€§åœŸå£¤';
            }

            if (conductivity > 1.5) {
                fertilizerAdvice += 'ï¼Œæ³¨æ„é™ä½ç›åˆ†å«é‡ï¼Œé¿å…è¿‡åº¦æ–½è‚¥';
            }

            document.getElementById('fertilizerAdvice').textContent = fertilizerAdvice;
        }

        // æ›´æ–°è€•ä½œå»ºè®®
        function updateTillageAdvice() {
            const waterContent = parseFloat(document.getElementById('waterContent').textContent.split('%')[0]);
            const organicMatter = parseFloat(document.getElementById('organicMatter').textContent.split('%')[0]);

            let tillageAdvice;
            if (waterContent > 70) {
                tillageAdvice = 'åœŸå£¤å«æ°´é‡è¿‡é«˜ï¼Œå»ºè®®é€‚å½“æ’æ°´åè¿›è¡Œæµ…è€•ï¼ˆ15-20cmï¼‰ï¼Œæ”¹å–„é€æ°”æ€§';
            } else if (waterContent < 60) {
                tillageAdvice = 'åœŸå£¤å«æ°´é‡è¾ƒä½ï¼Œå»ºè®®æ·±è€•ï¼ˆ30-40cmï¼‰å¹¶ç»“åˆçŒæº‰ï¼Œæå‡ä¿æ°´èƒ½åŠ›';
            } else {
                if (organicMatter < 2.5) {
                    tillageAdvice = 'å»ºè®®è¿›è¡Œä¸­è€•ï¼ˆ20-30cmï¼‰ï¼Œç»“åˆæœ‰æœºè‚¥æ–½ç”¨ï¼Œæå‡åœŸå£¤è‚¥åŠ›';
                } else {
                    tillageAdvice = 'å»ºè®®è¿›è¡Œå¸¸è§„è€•ä½œï¼ˆ20-30cmï¼‰ï¼Œä¿æŒåœŸå£¤ç»“æ„è‰¯å¥½';
                }
            }

            document.getElementById('tillageAdvice').textContent = tillageAdvice;
        }

        // 3DåœŸå£¤å‰–é¢åˆå§‹åŒ–
        function init3DView() {
            const container = document.getElementById('soilProfile3d');
            const width = container.clientWidth;
            const height = container.clientHeight;

            // åˆ›å»ºåœºæ™¯
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true });

            renderer.setSize(width, height);
            renderer.setClearColor(0xf8faf9);
            container.appendChild(renderer.domElement);

            // åˆ›å»ºåœŸå£¤å±‚
            const layers = [
                { color: 0x8B4513, height: 2, name: 'è¡¨å±‚åœŸå£¤' },
                { color: 0xA0522D, height: 3, name: 'è€•ä½œå±‚' },
                { color: 0xCD853F, height: 5, name: 'åº•åœŸå±‚' }
            ];

            layers.forEach((layer, index) => {
                const geometry = new THREE.BoxGeometry(4, layer.height, 4);
                const material = new THREE.MeshPhongMaterial({
                    color: layer.color,
                    transparent: true,
                    opacity: 0.8
                });
                const cube = new THREE.Mesh(geometry, material);
                cube.position.y = -index * layer.height;
                scene.add(cube);
            });

            // å…‰ç…§è®¾ç½®
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);

            // ç›¸æœºä½ç½®
            camera.position.set(8, 8, 8);
            camera.lookAt(0, 0, 0);

            // åŠ¨ç”»å¾ªç¯
            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }
            animate();
        }

        // å…»åˆ†åˆ†æå›¾è¡¨
        function initNutrientChart() {
            const chart = echarts.init(document.getElementById('nutrientChart'));
            const option = {
                tooltip: { trigger: 'axis' },
                radar: {
                    indicator: [
                        { name: 'æ°®å«é‡', max: 200 },
                        { name: 'ç£·å«é‡', max: 100 },
                        { name: 'é’¾å«é‡', max: 300 },
                        { name: 'æœ‰æœºè´¨', max: 5 },
                        { name: 'å¾®ç”Ÿç‰©', max: 100 }
                    ],
                    shape: 'polygon',
                    splitArea: { show: false },
                    axisLine: { lineStyle: { color: 'rgba(61, 140, 83, 0.3)' } }
                },
                series: [{
                    type: 'radar',
                    data: [{
                        value: [
                            Math.floor(Math.random() * 101) + 100, // æ°®å«é‡ (100-200)
                            Math.floor(Math.random() * 51) + 50,   // ç£·å«é‡ (50-100)
                            Math.floor(Math.random() * 201) + 100, // é’¾å«é‡ (100-300)
                            (Math.random() * 3.0 + 2.0).toFixed(1), // æœ‰æœºè´¨ (2.0-5.0)
                            Math.floor(Math.random() * 76) + 25    // å¾®ç”Ÿç‰© (25-100)
                        ],
                        name: 'å½“å‰å€¼',
                        areaStyle: { color: 'rgba(61, 140, 83, 0.3)' },
                        lineStyle: { color: '#3d8c53' }
                    }]
                }]
            };
            chart.setOption(option);
        }

        // æ—¶é—´é€‰æ‹©äº¤äº’
        function initTimeSelector() {
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.time-btn').forEach(b => {
                        b.classList.remove('active');
                        b.style.transform = 'none';
                    });
                    this.classList.add('active');
                    this.style.transform = 'scale(1.05)';

                    // æ›´æ–°æ•°æ®
                    generateRandomData();

                    // è¿™é‡Œå¯ä»¥æ·»åŠ æ•°æ®æ›´æ–°é€»è¾‘
                    console.log('é€‰æ‹©æ—¶é—´æ®µ:', this.textContent);
                });
            });
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            init3DView();
            initNutrientChart();
            initTimeSelector();
            generateRandomData(); // åˆå§‹åŠ è½½æ—¶ç”Ÿæˆéšæœºæ•°æ®
        };
    </script>
</body>

</html>